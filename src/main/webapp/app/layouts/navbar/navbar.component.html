@let accountRef = account();

<!-- ═══════════════════════════════════════════════════════════════
     BARRA SUPERIORE — trasparente, solo hamburger
═══════════════════════════════════════════════════════════════ -->
<nav data-cy="navbar" class="rh-topbar">
  <button class="rh-hamburger" type="button" (click)="toggleSidebar()" [attr.aria-expanded]="isSidebarOpen()" aria-label="Apri menu">
    @if (!isSidebarOpen()) {
      <svg
        width="22"
        height="22"
        viewBox="0 0 24 24"
        fill="none"
        stroke="white"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="3" y1="6" x2="21" y2="6" />
        <line x1="3" y1="12" x2="21" y2="12" />
        <line x1="3" y1="18" x2="21" y2="18" />
      </svg>
    } @else {
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    }
  </button>
</nav>

<!-- BACKDROP -->
@if (isSidebarOpen()) {
  <div class="rh-backdrop" (click)="closeSidebar()"></div>
}

<!-- ═══════════════════════════════════════════════════════════════
     DRAWER LATERALE SINISTRO
═══════════════════════════════════════════════════════════════ -->
<aside class="rh-drawer" [class.open]="isSidebarOpen()" aria-label="Menu navigazione">
  <!-- ── Header drawer con logo grande ── -->
  <div class="rh-drawer-header">
    <div class="rh-drawer-logo">
      <img src="content/images/LogoBianco.png" alt="RistoHub" class="rh-drawer-logo-img" />
    </div>
    <button class="rh-drawer-close" type="button" (click)="closeSidebar()" aria-label="Chiudi menu">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
  </div>

  <!-- ── Info utente ── -->
  @if (accountRef !== null) {
    <div class="rh-drawer-user">
      <div class="rh-drawer-avatar">
        @if (!accountRef.imageUrl) {
          <span>{{ accountRef.login ? accountRef.login.charAt(0).toUpperCase() : '?' }}</span>
        } @else {
          <img [src]="accountRef.imageUrl" alt="Avatar" />
        }
      </div>
      <div class="rh-drawer-user-info">
        <span class="rh-drawer-username">{{ accountRef.login }}</span>
        <span class="rh-drawer-email">{{ accountRef.email }}</span>
      </div>
    </div>
    <div class="rh-drawer-divider"></div>
  }

  <!-- ── Navigazione principale ── -->
  <nav class="rh-drawer-nav">
    <!-- Home -->
    <a
      class="rh-drawer-link"
      routerLink="/home"
      routerLinkActive="active"
      [routerLinkActiveOptions]="{ exact: true }"
      (click)="closeSidebar()"
    >
      <!-- Casa -->
      <svg
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.8"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M3 9.5L12 3l9 6.5V20a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1z" />
        <path d="M9 21V12h6v9" />
      </svg>
      <span>Home</span>
    </a>

    @if (accountRef !== null) {
      <!-- I miei Menu — libro aperto -->
      <a class="rh-drawer-link" routerLink="/menu-list" routerLinkActive="active" (click)="closeSidebar()">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
        </svg>
        <span>I miei Menu</span>
      </a>

      <!-- Crea Menu — bacchetta magica -->
      <a class="rh-drawer-link" routerLink="/menu-wizard" routerLinkActive="active" (click)="closeSidebar()">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M15 4V2" />
          <path d="M15 16v-2" />
          <path d="M8 9h2" />
          <path d="M20 9h2" />
          <path d="M17.8 11.8 19 13" />
          <path d="M15 9h.01" />
          <path d="M17.8 6.2 19 5" />
          <path d="M3 21l9-9" />
          <path d="M12.2 6.2 11 5" />
        </svg>
        <span>Crea Menu</span>
      </a>

      <!-- Piatti del Giorno — posate -->
      <a class="rh-drawer-link" routerLink="/piatti-giorno" routerLinkActive="active" (click)="closeSidebar()">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" />
          <path d="M7 2v20" />
          <path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7" />
        </svg>
        <span>Piatti del Giorno</span>
      </a>

      <!-- Contatti — icona persona (visibile a tutti gli utenti loggati, NON solo admin) -->
      <a class="rh-drawer-link" routerLink="/contatti" routerLinkActive="active" (click)="closeSidebar()">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
          <circle cx="12" cy="7" r="4" />
        </svg>
        <span>Contatti</span>
      </a>

      <!-- Prodotti — etichetta/tag -->
      <a class="rh-drawer-link" routerLink="/prodotto-add" routerLinkActive="active" (click)="closeSidebar()">
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" />
          <line x1="7" y1="7" x2="7.01" y2="7" />
        </svg>
        <span>Prodotti</span>
      </a>

      <!-- GESTIONE — solo ADMIN — ingranaggi -->
      <div *jhiHasAnyAuthority="'ROLE_ADMIN'" class="rh-drawer-section">
        <button class="rh-drawer-section-toggle" type="button" (click)="toggleGestione()">
          <div class="rh-drawer-section-left">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3" />
              <path d="M19.07 4.93a10 10 0 0 1 0 14.14M4.93 4.93a10 10 0 0 0 0 14.14" />
            </svg>
            <span>Gestione</span>
          </div>
          <svg
            class="rh-chevron"
            [class.rotated]="gestioneExpanded()"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        @if (gestioneExpanded()) {
          <div class="rh-drawer-submenu">
            <a
              class="rh-drawer-sublink"
              routerLink="/menu"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Menu</a
            >
            <a
              class="rh-drawer-sublink"
              routerLink="/portata"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Portate</a
            >
            <a
              class="rh-drawer-sublink"
              routerLink="/prodotto"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Prodotti</a
            >
            <a
              class="rh-drawer-sublink"
              routerLink="/allergene"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Allergeni</a
            >
            <a
              class="rh-drawer-sublink"
              routerLink="/piatto-del-giorno"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Piatti del Giorno</a
            >
          </div>
        }
      </div>

      <!-- ADMIN — solo ADMIN — scudo -->
      <div *jhiHasAnyAuthority="'ROLE_ADMIN'" class="rh-drawer-section rh-drawer-section-admin">
        <button class="rh-drawer-section-toggle rh-admin-toggle" type="button" (click)="toggleAdmin()">
          <div class="rh-drawer-section-left">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.8"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
            </svg>
            <span>Admin</span>
          </div>
          <svg
            class="rh-chevron"
            [class.rotated]="adminExpanded()"
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        @if (adminExpanded()) {
          <div class="rh-drawer-submenu">
            <a
              class="rh-drawer-sublink"
              routerLink="/authority"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              (click)="closeSidebar()"
              >Authority</a
            >
            <a class="rh-drawer-sublink" routerLink="/admin/user-management" routerLinkActive="active" (click)="closeSidebar()"
              >Gestione Utenti</a
            >
            <a class="rh-drawer-sublink" routerLink="/admin/metrics" routerLinkActive="active" (click)="closeSidebar()">Metriche</a>
            <a class="rh-drawer-sublink" routerLink="/admin/health" routerLinkActive="active" (click)="closeSidebar()">Integrità</a>
            <a class="rh-drawer-sublink" routerLink="/admin/configuration" routerLinkActive="active" (click)="closeSidebar()"
              >Configurazione</a
            >
            <a class="rh-drawer-sublink" routerLink="/admin/logs" routerLinkActive="active" (click)="closeSidebar()">Log</a>
            @if (openAPIEnabled) {
              <a class="rh-drawer-sublink" routerLink="/admin/docs" routerLinkActive="active" (click)="closeSidebar()">API Docs</a>
            }
          </div>
        }
      </div>
    }
  </nav>

  <div class="rh-drawer-divider rh-drawer-divider-bottom"></div>

  <!-- ── Sezione account in fondo ── -->
  <div class="rh-drawer-account">
    @if (accountRef !== null) {
      <!-- Impostazioni — sliders -->
      <a
        class="rh-drawer-link rh-drawer-link-sm"
        routerLink="/account/settings"
        routerLinkActive="active"
        (click)="closeSidebar()"
        data-cy="settings"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="4" y1="6" x2="20" y2="6" />
          <line x1="4" y1="12" x2="20" y2="12" />
          <line x1="4" y1="18" x2="20" y2="18" />
          <circle cx="8" cy="6" r="2" fill="currentColor" stroke="none" />
          <circle cx="16" cy="12" r="2" fill="currentColor" stroke="none" />
          <circle cx="10" cy="18" r="2" fill="currentColor" stroke="none" />
        </svg>
        <span>Impostazioni</span>
      </a>

      <!-- Password — lucchetto -->
      <a
        class="rh-drawer-link rh-drawer-link-sm"
        routerLink="/account/password"
        routerLinkActive="active"
        (click)="closeSidebar()"
        data-cy="passwordItem"
      >
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
          <path d="M7 11V7a5 5 0 0 1 10 0v4" />
        </svg>
        <span>Password</span>
      </a>

      <!-- Esci — freccia uscita -->
      <button class="rh-drawer-link rh-drawer-link-sm rh-drawer-logout" type="button" (click)="logout()" id="logout" data-cy="logout">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
          <polyline points="16 17 21 12 16 7" />
          <line x1="21" y1="12" x2="9" y2="12" />
        </svg>
        <span>Esci</span>
      </button>
    } @else {
      <!-- Accedi -->
      <button class="rh-drawer-link rh-drawer-link-sm" type="button" (click)="login()">
        <svg
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.8"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
          <polyline points="10 17 15 12 10 7" />
          <line x1="15" y1="12" x2="3" y2="12" />
        </svg>
        <span>Accedi</span>
      </button>
    }
  </div>
</aside>

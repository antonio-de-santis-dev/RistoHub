<div class="rh-home">
  <!-- HERO -->
  <div class="rh-hero">
    <div class="rh-hero-content">
      <img src="content/images/LogoBianco.png" alt="RistoHub" class="rh-hero-logo" />
      <p class="rh-hero-tagline">Il tuo menu digitale professionale</p>
    </div>
  </div>

  <!-- DASHBOARD -->
  @if (account() !== null) {
    <div class="rh-dashboard">
      <div class="rh-dashboard-greeting">
        <h2>
          Ciao, <span class="rh-user-name">{{ account()?.login }}</span> üëã
        </h2>
        <p>Ecco il riepilogo della tua situazione oggi</p>
      </div>

      <div class="rh-dash-grid">
        <!-- CARD 1: Piatti del Giorno -->
        <div class="rh-dash-card">
          <div class="rh-card-header">
            <span class="rh-card-icon">‚ú®</span>
            <div class="rh-card-header-text">
              <h3>Piatti del Giorno</h3>
              <p>Piatti speciali attivi oggi</p>
            </div>
            <a routerLink="/piatti-giorno" class="rh-card-link">
              Gestisci
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="5" y1="12" x2="19" y2="12" />
                <polyline points="12 5 19 12 12 19" />
              </svg>
            </a>
          </div>

          @if (isLoadingPiatti) {
            <div class="rh-card-loading">
              <div class="rh-mini-spinner"></div>
              <span>Caricamento...</span>
            </div>
          } @else if (piattiAttivi.length === 0) {
            <div class="rh-card-empty">
              <span class="rh-empty-icon">üçΩÔ∏è</span>
              <p>Nessun piatto del giorno attivo</p>
              <a routerLink="/piatti-giorno" class="rh-empty-cta">Aggiungi un piatto ‚Üí</a>
            </div>
          } @else {
            <div class="rh-piatti-list">
              @for (piatto of piattiAttivi.slice(0, 6); track piatto.id) {
                <div class="rh-piatto-row">
                  <div class="rh-piatto-info">
                    <span class="rh-piatto-nome">{{ piatto.nome ?? piatto.prodotto?.nome ?? '‚Äî' }}</span>
                    @if (piatto.menu?.nome) {
                      <span class="rh-piatto-menu">{{ piatto.menu.nome }}</span>
                    }
                  </div>
                  <span class="rh-piatto-prezzo">{{ formatPrezzo(piatto.prezzo ?? piatto.prodotto?.prezzo) }}</span>
                </div>
              }
              @if (piattiAttivi.length > 6) {
                <div class="rh-more-items">
                  <a routerLink="/piatti-giorno">+ altri {{ piattiAttivi.length - 6 }} piatti ‚Üí</a>
                </div>
              }
            </div>
          }
        </div>

        <!-- CARD 2: I miei Menu ‚Äî icona cambiata, rimossi cerchi colore -->
        <div class="rh-dash-card">
          <div class="rh-card-header">
            <!-- Nuova icona: libro/menu aperto -->
            <span class="rh-card-icon">
              <svg
                width="22"
                height="22"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.8"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
              </svg>
            </span>
            <div class="rh-card-header-text">
              <h3>I miei Menu</h3>
              <p>Menu attualmente attivi</p>
            </div>
            <a routerLink="/menu-list" class="rh-card-link">
              Gestisci
              <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <line x1="5" y1="12" x2="19" y2="12" />
                <polyline points="12 5 19 12 12 19" />
              </svg>
            </a>
          </div>

          @if (isLoadingMenus) {
            <div class="rh-card-loading">
              <div class="rh-mini-spinner"></div>
              <span>Caricamento...</span>
            </div>
          } @else if (menuAttivi.length === 0) {
            <div class="rh-card-empty">
              <span class="rh-empty-icon">üìã</span>
              <p>Nessun menu attivo</p>
              <a routerLink="/menu-wizard" class="rh-empty-cta">Crea il tuo primo menu ‚Üí</a>
            </div>
          } @else {
            <div class="rh-menus-list">
              @for (menu of menuAttivi; track menu.id) {
                <div class="rh-menu-row" (click)="apriMenu(menu.id)">
                  <!-- RIMOSSO il cerchio colore, sostituito con indicatore stato -->
                  <div class="rh-menu-stato" [class.rh-menu-attivo]="menu.attivo" [class.rh-menu-inattivo]="!menu.attivo"></div>
                  <div class="rh-menu-info">
                    <span class="rh-menu-nome">{{ menu.nome }}</span>
                    @if (menu.descrizione) {
                      <span class="rh-menu-desc">{{ menu.descrizione }}</span>
                    }
                  </div>
                  <button class="rh-qr-btn" (click)="$event.stopPropagation(); apriQr(menu.id)" title="QR Code">
                    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="7" height="7" />
                      <rect x="14" y="3" width="7" height="7" />
                      <rect x="3" y="14" width="7" height="7" />
                      <rect x="14" y="14" width="3" height="3" />
                    </svg>
                  </button>
                </div>
              }
            </div>
          }
        </div>
      </div>
    </div>
  }

  <!-- FOOTER INTERNO -->
  <footer class="rh-home-footer">
    <p>¬© 2025 <strong>RistoHub</strong> ‚Äî Il tuo menu digitale professionale</p>
  </footer>

  <!-- QR MODAL -->
  @if (qrVisible && qrMenuId) {
    <div class="rh-modal-overlay" (click)="chiudiQr()">
      <div class="rh-modal" (click)="$event.stopPropagation()">
        <span class="rh-modal-icon">üì±</span>
        <h3>QR Code Menu</h3>
        <div class="rh-qr-wrap">
          <img [src]="qrImageUrl" alt="QR Code" class="rh-qr-img" />
        </div>
        <p class="rh-qr-link">{{ qrUrl }}</p>
        <div class="rh-modal-actions">
          <a [href]="qrImageUrl" download="qr-menu.png" class="rh-btn-download">‚¨á Scarica PNG</a>
          <button (click)="chiudiQr()" class="rh-btn-close">Chiudi</button>
        </div>
      </div>
    </div>
  }
</div>

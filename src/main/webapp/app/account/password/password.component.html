<div class="pw-page">
  <div class="pw-inner">
    <a routerLink="/account/settings" class="pw-back">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M19 12H5M12 19l-7-7 7-7" />
      </svg>
      Torna al profilo
    </a>

    <div class="pw-card">
      <div class="pw-card-header">
        <div class="pw-icon">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
            <path d="M7 11V7a5 5 0 0 1 10 0v4" />
          </svg>
        </div>
        <div>
          <h1>Cambia Password</h1>
          @if (account && account()?.login) {
            <p>
              Stai modificando la password per <strong>{{ account()?.login }}</strong>
            </p>
          }
        </div>
      </div>

      @if (success()) {
        <div class="pw-alert pw-alert-success">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
            <polyline points="22 4 12 14.01 9 11.01" />
          </svg>
          Password modificata con successo!
        </div>
      }
      @if (error()) {
        <div class="pw-alert pw-alert-error">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          Errore! Impossibile cambiare la password.
        </div>
      }
      @if (doNotMatch()) {
        <div class="pw-alert pw-alert-error">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          Le password non corrispondono!
        </div>
      }

      <form (ngSubmit)="changePassword()" [formGroup]="passwordForm" class="pw-form">
        <div class="pw-field">
          <label class="pw-label" for="currentPassword">Password Attuale</label>
          <div class="pw-input-wrap">
            <svg class="pw-field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
            <input
              type="password"
              class="pw-input"
              id="currentPassword"
              placeholder="Inserisci la password attuale"
              formControlName="currentPassword"
              data-cy="currentPassword"
              autocomplete="current-password"
            />
          </div>
          @let cp = passwordForm.get('currentPassword')!;
          @if (cp.invalid && (cp.dirty || cp.touched)) {
            <span class="pw-error">La password è obbligatoria.</span>
          }
        </div>

        <div class="pw-field">
          <label class="pw-label" for="newPassword">Nuova Password</label>
          <div class="pw-input-wrap">
            <svg class="pw-field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
            <input
              type="password"
              class="pw-input"
              id="newPassword"
              placeholder="Crea una nuova password"
              formControlName="newPassword"
              data-cy="newPassword"
              autocomplete="new-password"
            />
          </div>
          @let np = passwordForm.get('newPassword')!;
          @if (np.invalid && (np.dirty || np.touched)) {
            <span class="pw-error">
              @if (np.errors?.['required']) {
                La password è obbligatoria.
              }
              @if (np.errors?.['minlength']) {
                Almeno 4 caratteri.
              }
              @if (np.errors?.['maxlength']) {
                Massimo 50 caratteri.
              }
            </span>
          }
        </div>

        <div class="pw-field">
          <label class="pw-label" for="confirmPassword">Conferma Nuova Password</label>
          <div class="pw-input-wrap">
            <svg class="pw-field-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />
              <path d="M7 11V7a5 5 0 0 1 10 0v4" />
            </svg>
            <input
              type="password"
              class="pw-input"
              id="confirmPassword"
              placeholder="Ripeti la nuova password"
              formControlName="confirmPassword"
              data-cy="confirmPassword"
              autocomplete="new-password"
            />
          </div>
          @let conf = passwordForm.get('confirmPassword')!;
          @if (conf.invalid && (conf.dirty || conf.touched)) {
            <span class="pw-error">
              @if (conf.errors?.['required']) {
                La conferma è obbligatoria.
              }
              @if (conf.errors?.['minlength']) {
                Almeno 4 caratteri.
              }
              @if (conf.errors?.['maxlength']) {
                Massimo 50 caratteri.
              }
            </span>
          }
        </div>

        <button type="submit" class="pw-btn-save" [disabled]="passwordForm.invalid" data-cy="submit">
          Aggiorna Password
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M5 12h14M12 5l7 7-7 7" />
          </svg>
        </button>
      </form>
    </div>
  </div>

  <footer class="pw-footer">
    <p>© 2025 <strong>RistoHub</strong> — Il tuo menu digitale professionale</p>
  </footer>
</div>
